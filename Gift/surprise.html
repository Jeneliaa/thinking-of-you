<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Happy Birthday Chaw Lai</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Pacifico&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{
    --pink1:#ff9a9e;
    --pink2:#ffd1dc;
    --pink3:#ff6b81;
    --gold:#e1b382;
}

*{box-sizing:border-box}

body{
    margin:0;
    min-height:100svh;
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:'Poppins',sans-serif;
    background:linear-gradient(135deg,var(--pink1),var(--pink2));
    overflow:hidden;
    transition:background 1s ease;
}

.dark-mode{
    background:radial-gradient(circle at top,#1a001a,#000);
}

canvas{
    position:fixed;
    inset:0;
    pointer-events:none;
}
#fireworks{z-index:1;display:none}
#sparkles{z-index:5}

.main-card{
    background:rgba(255,255,255,.25);
    backdrop-filter:blur(18px);
    border-radius:32px;
    padding:clamp(1.8rem,4vw,2.8rem);
    width:min(90%,420px);
    text-align:center;
    border:1px solid rgba(255,255,255,.3);
    position:relative;
    z-index:10;
}

.step-4-style{
    background:transparent;
    backdrop-filter:none;
    border:none;
}

.step{display:none}
.step.active{display:block;animation:fade .9s ease forwards}

@keyframes fade{
    from{opacity:0;transform:scale(.92)}
    to{opacity:1;transform:scale(1)}
}

.glow-text{
    font-family:'Pacifico',cursive;
    font-size:clamp(2.2rem,6vw,3rem);
    color:#fff;
    text-shadow:
        0 0 6px rgba(255,182,193,.8),
        0 0 18px rgba(255,105,180,.6);
}

/* COUNTDOWN */
.countdown-wrap {
    width: 200px;
    height: 200px;
    margin: auto;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.countdown-svg {
    position: absolute;
    transform: rotate(-90deg);
}

.countdown-svg circle {
    fill: none;
    stroke-width: 8;
    stroke-linecap: round;
}

.circle-bg { stroke: rgba(255, 255, 255, 0.2); }
.circle-progress {
    stroke: #fff;
    stroke-dasharray: 565;
    stroke-dashoffset: 0;
    transition: stroke-dashoffset 1s linear;
}

#countdown-timer{
    font-size: 6rem;
    font-weight: 700;
    color: white;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    z-index: 2;
}

.btn{
    background:white;
    color:var(--pink3);
    border:none;
    padding:12px 36px;
    border-radius:50px;
    font-weight:600;
    margin-top:25px;
    cursor:pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}
.btn:active { transform: scale(0.95); }

/* CAKE */
.cake-wrapper {
    width: 220px;
    height: 250px;
    margin: 20px auto;
    position: relative;
    cursor: pointer;
    transform-style: preserve-3d;
    animation: cakeFloat 4s ease-in-out infinite;
}

@keyframes cakeFloat {
    0%, 100% { transform: translateY(0) rotate(-1deg); }
    50% { transform: translateY(-12px) rotate(1deg); }
}

.tier {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 12px 12px 5px 5px;
    box-shadow: inset 0 -10px 20px rgba(0,0,0,0.05);
}

.tier-1 { width: 180px; height: 60px; bottom: 0; background: #ffc1cc; z-index: 1; }
.tier-2 { width: 130px; height: 55px; bottom: 60px; background: #ffd1dc; z-index: 2; }
.tier-3 { width: 80px; height: 50px; bottom: 115px; background: #fff; z-index: 3; }

.drip {
    position: absolute;
    top: 0;
    width: 100%;
    height: 12px;
    background: #ff6b81;
    border-radius: 10px 10px 0 0;
}
.drip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    height: 12px;
    background-image: radial-gradient(circle, #ff6b81 50%, transparent 51%);
    background-size: 16px 20px;
}

.cherry {
    position: absolute;
    width: 12px;
    height: 12px;
    background: #ff4757;
    border-radius: 50%;
    top: -6px;
}

.candle-unit {
    position: absolute;
    bottom: 165px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10;
}
.stick {
    width: 8px;
    height: 45px;
    background: repeating-linear-gradient(45deg, #fff, #fff 4px, #ffb1c1 4px, #ffb1c1 8px);
    border-radius: 4px;
}
.flame {
    width: 16px;
    height: 26px;
    background: radial-gradient(circle, #fff, #fffa65, #ff9f43, transparent);
    border-radius: 50% 50% 20% 20%;
    position: absolute;
    top: -24px;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: 0 0 20px #ff9f43;
    animation: flicker 0.1s infinite alternate;
}

@keyframes flicker {
    0% { transform: translateX(-50%) scale(1); opacity: 0.9; }
    100% { transform: translateX(-52%) scale(1.1); opacity: 1; }
}

/* MESSAGE CARD */
.final-card{
    background:#fffdfa;
    padding:35px 25px;
    border-radius:12px;
    border:1px solid #eee;
    text-align: left;
    position: relative;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
}

.final-card::before {
    content: '';
    position: absolute;
    inset: 10px;
    border: 1px solid var(--gold);
    opacity: 0.3;
    pointer-events: none;
}

#typewriter-text {
    font-family: 'Georgia', serif;
    font-style: italic;
    font-size: 1.05rem;
    color: #444;
    line-height: 1.8;
    min-height: 150px;
    white-space: pre-wrap;
}

.cursor { font-weight: bold; color: var(--pink3); animation: blink 0.7s infinite; }
@keyframes blink { 50% { opacity: 0; } }

#signature {
    text-align: right;
    font-family: 'Pacifico', cursive;
    color: #ff6b81;
    font-size: 1.2rem;
    opacity: 0;
    transform: translateY(10px);
    transition: all 1.5s ease;
    margin-top: 20px;
}

#signature.show {
    opacity: 1;
    transform: translateY(0);
}

.replay-btn {
    margin-top: 20px;
    color: white;
    cursor: pointer;
    font-size: 0.75rem;
    opacity: 0.6;
    text-decoration: underline;
    display: inline-block;
}
</style>
</head>

<body>

<canvas id="fireworks"></canvas>
<canvas id="sparkles"></canvas>

<audio id="sfx-open" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" type="audio/mpeg">
</audio>
<audio id="sfx-tick" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/2544/2544-preview.mp3" type="audio/mpeg">
</audio>

<div id="container" class="main-card">

<div id="step-1" class="step active">
    <p style="color:white">üíå I have something for you...</p>
    <button class="btn" onclick="nextStep(2)">Open Surprise</button>
</div>

<div id="step-2" class="step">
    <p style="color:white">It's your special day üíù...</p>
    <button class="btn" style="background:var(--pink3);color:white" onclick="startCountdown()">Enter My Day üéÇ</button>
</div>

<div id="step-3" class="step">
    <div class="countdown-wrap">
        <svg class="countdown-svg" width="200" height="200">
            <circle class="circle-bg" cx="100" cy="100" r="90"></circle>
            <circle class="circle-progress" id="progress" cx="100" cy="100" r="90"></circle>
        </svg>
        <div id="countdown-timer">3</div>
    </div>
</div>

<div id="step-4" class="step">
    <h1 class="glow-text">Happiest Birthday, ChawLai</h1>
    <button class="btn" onclick="nextStep(5)">Celebrate üíñ</button>
</div>

<div id="step-5" class="step">
    <h2 style="color:#ec407a">Blow the Candle üå¨Ô∏è</h2>
    <div class="cake-wrapper" onclick="blowCandle()">
        <div class="candle-unit">
            <div class="flame" id="flame"></div>
            <div class="stick"></div>
        </div>
        <div class="tier tier-3">
            <div class="drip"></div>
            <div class="cherry" style="left: 10%;"></div>
            <div class="cherry" style="right: 10%;"></div>
        </div>
        <div class="tier tier-2">
            <div class="drip"></div>
            <div style="position:absolute; bottom:10px; left:15px;">üçì</div>
            <div style="position:absolute; bottom:10px; right:15px;">üçì</div>
        </div>
        <div class="tier tier-1">
            <div class="drip"></div>
            <div style="position:absolute; bottom:15px; left:45%;">üíñ</div>
        </div>
    </div>
    <button id="nextBtn" class="btn" style="display:none" onclick="nextStep(6)">View Message ‚Üí</button>
</div>

<div id="step-6" class="step">
    <div class="final-card">
        <h4 style="color:var(--gold); letter-spacing: 2px; text-transform: uppercase; font-size: 0.8rem; margin: 0 0 10px 0; text-align: center;">A Wish For You</h4>
        <div id="typewriter-text"></div>
        <p id="signature">With love, Always. ‚ù§Ô∏è</p>
    </div>
    <span class="replay-btn" onclick="resetSurprise()">Watch it again? ‚ú®</span>
</div>

</div>

<script>
const fw=document.getElementById("fireworks"),ctx=fw.getContext("2d");
const sp=document.getElementById("sparkles"),sctx=sp.getContext("2d");

function playSFX(id) {
    const sound = document.getElementById(id);
    if(sound) {
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Sound interaction needed"));
    }
}

function resize(){
    const dpr=devicePixelRatio||1;
    [fw,sp].forEach(c=>{
        c.width=innerWidth*dpr;
        c.height=innerHeight*dpr;
        c.style.width=innerWidth+"px";
        c.style.height=innerHeight+"px";
        c.getContext("2d").setTransform(dpr,0,0,dpr,0,0);
    });
}
resize();addEventListener("resize",resize);

let celebrating=false;

function nextStep(n){
    // Open action sound on every click (except the middle of countdown)
    playSFX('sfx-open');

    document.querySelectorAll(".step").forEach(s=>s.classList.remove("active"));
    document.getElementById("step-"+n).classList.add("active");

    if(n===4){
        document.body.classList.add("dark-mode");
        container.classList.add("step-4-style");
        fw.style.display="block";
        celebrating=true;
        animateFireworks();
    } else if (n === 6) {
        const msg = "Dear Chaw Lai,\n\nOn this beautiful day, I want you to know how truly special you are, just like these sparkles \n\nMay your year ahead be as sweet as this cake and filled with endless joy, laughter, and success. Happy Birthday! ‚ú®";
        setTimeout(() => typeWriter(msg, 0), 500);
    } else {
        celebrating=false;
        fw.style.display="none";
        document.body.classList.remove("dark-mode");
        container.classList.remove("step-4-style");
    }
}

function startCountdown(){
    nextStep(3); // This plays the sfx-open via nextStep
    let c=3;
    const el=document.getElementById("countdown-timer");
    const progress = document.getElementById("progress");
    const total = 565; 
    
    el.textContent=c;
    playSFX('sfx-tick'); // First tick
    progress.style.strokeDashoffset = 0;

    const t=setInterval(()=>{
        c--;
        if(c >= 0) {
            el.textContent=c;
            playSFX('sfx-tick'); // Sound for 2, 1, 0
            progress.style.strokeDashoffset = total - (total * (c / 3));
        }
        if(c === -1){
            clearInterval(t);
            nextStep(4);
        }
    },1000);
}

function typeWriter(text, i) {
    const el = document.getElementById("typewriter-text");
    if (i < text.length) {
        el.innerHTML = text.substring(0, i + 1) + '<span class="cursor">|</span>';
        setTimeout(() => typeWriter(text, i + 1), Math.random() * 50 + 40);
    } else {
        el.innerHTML = text;
        document.getElementById("signature").classList.add("show");
    }
}

function resetSurprise() {
    document.getElementById("typewriter-text").innerHTML = "";
    document.getElementById("signature").classList.remove("show");
    document.getElementById("flame").style.display = "block";
    document.getElementById("nextBtn").style.display = "none";
    nextStep(1);
}

const colors=["#ff9a9e","#ff6b81","#ffd1dc","#f48fb1"];
let particles=[];
class Particle{
    constructor(x,y){
        this.x=x;this.y=y;
        this.life=1;
        this.color=colors[Math.random()*colors.length|0];
        const a=Math.random()*Math.PI*2;
        const s=Math.random()*5+2;
        this.vx=Math.cos(a)*s;
        this.vy=Math.sin(a)*s;
    }
    update(){
        this.vx*=.96;
        this.vy+=.08;
        this.x+=this.vx;
        this.y+=this.vy;
        this.life-=.015;
    }
    draw(){
        ctx.globalAlpha=this.life;
        ctx.fillStyle=this.color;
        ctx.beginPath();
        ctx.arc(this.x,this.y,2.2,0,Math.PI*2);
        ctx.fill();
    }
}

function explode(x,y){
    for(let i=0;i<80;i++)particles.push(new Particle(x,y));
}

function animateFireworks(){
    if(!celebrating)return;
    ctx.fillStyle="rgba(0,0,0,.25)";
    ctx.fillRect(0,0,fw.width,fw.height);
    if(Math.random()<.06)explode(Math.random()*innerWidth,Math.random()*innerHeight*.5);
    particles=particles.filter(p=>p.life>0);
    particles.forEach(p=>{p.update();p.draw()});
    requestAnimationFrame(animateFireworks);
}

addEventListener("mousemove",e=>{
    sctx.fillStyle="rgba(255,182,193,.7)";
    sctx.beginPath();
    sctx.arc(e.clientX,e.clientY,2,0,Math.PI*2);
    sctx.fill();
});

function blowCandle(){
    playSFX('sfx-open'); // Play click sound when blowing out candle
    document.getElementById("flame").style.display="none";
    document.getElementById("nextBtn").style.display="inline-block";
    confetti({ 
        particleCount: 200, 
        spread: 80, 
        origin: { y: 0.6 },
        colors: colors 
    });
}
</script>

</body>
</html>
